<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8" />
    <title>Music Memory Quiz</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
        background: #111;
        color: #eee;
      }

      #controls,
      #game {
        margin-top: 20px;
      }

      button {
        padding: 10px 15px;
        margin: 5px;
        border: none;
        border-radius: 6px;
        background: #28a745;
        color: white;
        cursor: pointer;
      }

      button:hover {
        background: #218838;
      }

      input {
        padding: 8px;
        margin: 5px;
        border-radius: 6px;
        border: 1px solid #333;
      }

      #progress-container {
        width: 80%;
        height: 10px;
        background: #333;
        margin: 10px auto;
        border-radius: 5px;
        overflow: hidden;
      }

      #progress {
        width: 0%;
        height: 100%;
        background: lime;
      }

      #answer-bank button {
        background: #444;
        margin: 3px;
      }

      #status {
        position: fixed;
        bottom: 10px;
        left: 10px;
        font-size: 14px;
      }

      /* Overlay feedback (PC + Mobile) */
      #overlay-feedback {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.85);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease-in-out;
      }

      #feedback {
        font-size: 2.5em;
        font-weight: bold;
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        max-width: 90%;
        line-height: 1.3;
      }

      @media (max-width: 600px) {
        body {
          padding: 10px;
        }

        #progress-container {
          width: 95%;
        }

        input {
          width: 90%;
          box-sizing: border-box;
        }

        button {
          padding: 15px 25px;
          font-size: 1.1em;
          display: block;
          width: 90%;
          margin: 10px auto;
        }

        #answer-bank button {
          display: inline-block;
          width: auto;
          padding: 12px 18px;
          margin: 4px;
          font-size: 0.9em;
        }

        #status {
          font-size: 12px;
          bottom: 5px;
          left: 5px;
        }

        #feedback {
          font-size: 1.8em;
        }
      }
    </style>
  </head>

  <body>
    <h1>Ac Dec Music Memory Quiz :o</h1>
    <div>
      <button onclick="setMode('easy')">Easy Mode</button>
      <button onclick="setMode('hard')">Hard Mode</button>
    </div>

    <div id="game">
      <button onclick="nextSong()">Next Song</button>
      <button onclick="repeatSnippet()">Repeat</button><br />

      <div id="controls">
        <button onclick="togglePlay()">‚ñ∂Ô∏è/‚è∏</button>
        <div id="progress-container">
          <div id="progress"></div>
        </div>
      </div>

      <div id="hard-input">
        <input type="text" id="guess" placeholder="Type your guess" />
        <button onclick="submitGuess()">Submit Guess</button>
      </div>

      <div id="answer-bank"></div>

      <div id="overlay-feedback">
        <div id="feedback"></div>
      </div>
      <div id="score"></div>
    </div>

    <div id="status">Idle</div>

    <audio id="player"></audio>

    <script>
      // Songs list (make sure MP3s exist in /songs/)
      let songs = [
        { title: "Lost Your Head Blues", file: "songs/lost.mp3" },
        { title: "Dippermouth Blues", file: "songs/dippermouth.mp3" },
        { title: "Hotter Than That", file: "songs/hotter.mp3" },
        { title: "The Stampede", file: "songs/stampede.mp3" },
        { title: "The Charleston", file: "songs/charleston.mp3" },
        { title: "Tea for Two", file: "songs/tea.mp3" },
        { title: "Can‚Äôt Help Lovin‚Äô Dat Man", file: "songs/canthelp.mp3" },
        { title: "Sweet Georgia Brown", file: "songs/georgia.mp3" },
        { title: "Toot, Toot, Tootsie!", file: "songs/tootsie.mp3" },
        { title: "La cr√©ation du monde", file: "songs/creation.mp3" },
        { title: "Rhapsody in Blue", file: "songs/rhapsody.mp3" },
        {
          title: "Music for the Theatre ‚Äì Burlesque",
          file: "songs/burlesque.mp3",
        },
        { title: "Violin Sonata No. 2 ‚Äì Blues", file: "songs/violin.mp3" },
        { title: "Sicilienne", file: "songs/sicilienne.mp3" },
      ];

      let mode = "hard";
      let audio = document.getElementById("player");
      let currentSong = null;
      let score = 0,
        total = 0;
      let snippetStart = 0,
        snippetEnd = 0;
      let progressInterval;

      function setMode(selected) {
        mode = selected;
        document.getElementById("answer-bank").style.display =
          mode === "easy" ? "block" : "none";
        document.getElementById("hard-input").style.display =
          mode === "hard" ? "block" : "none";
        renderAnswerBank();
      }

      function renderAnswerBank() {
        const bank = document.getElementById("answer-bank");
        bank.innerHTML = "";
        if (mode === "easy") {
          songs.forEach((song) => {
            let btn = document.createElement("button");
            btn.textContent = song.title;
            btn.onclick = () => submitGuess(song.title);
            bank.appendChild(btn);
          });
        }
      }

      function nextSong() {
        document.getElementById("guess").value = "";
        currentSong = songs[Math.floor(Math.random() * songs.length)];
        total++;

        audio.src = currentSong.file;
        audio.load();

        audio.onloadedmetadata = () => {
          let duration = audio.duration;
          snippetStart = Math.max(
            0,
            Math.floor(Math.random() * (duration - 15))
          );
          snippetEnd = snippetStart + 15;
          audio.currentTime = snippetStart;
          audio.play();
          updateStatus("üéµ Now Playing...");
          trackProgress();
        };
      }

      function repeatSnippet() {
        if (currentSong) {
          audio.currentTime = snippetStart;
          audio.play();
          updateStatus("üéµ Now Playing...");
          trackProgress();
        }
      }

      function togglePlay() {
        if (audio.paused) {
          audio.play();
          updateStatus("üéµ Now Playing...");
        } else {
          audio.pause();
          updateStatus("‚è∏ Paused");
        }
      }

      function trackProgress() {
        clearInterval(progressInterval);
        let bar = document.getElementById("progress");
        progressInterval = setInterval(() => {
          if (!audio.paused) {
            let pct =
              ((audio.currentTime - snippetStart) /
                (snippetEnd - snippetStart)) *
              100;
            bar.style.width = Math.min(100, Math.max(0, pct)) + "%";
            if (audio.currentTime >= snippetEnd) {
              audio.pause();
              clearInterval(progressInterval);
              updateStatus("‚úÖ Snippet Ended");
            }
          }
        }, 200);
      }

      function submitGuess(inputGuess = null) {
        let guess = inputGuess || document.getElementById("guess").value.trim();
        if (!guess) {
          showOverlay("‚ùå Enter a guess!", "red");
          return;
        }

        audio.pause();
        clearInterval(progressInterval);
        document.getElementById("progress").style.width = "0%";
        updateStatus("Idle");

        let normalizedGuess = guess.toLowerCase();
        let normalizedAnswer = currentSong.title.toLowerCase();

        if (levenshtein(normalizedGuess, normalizedAnswer) <= 3) {
          score++;
          showOverlay("‚úÖ Correct! " + currentSong.title, "lime");
        } else {
          showOverlay("‚ùå Incorrect! " + currentSong.title, "red");
        }

        document.getElementById(
          "score"
        ).textContent = `Score: ${score}/${total}`;

        if (total < songs.length) {
          setTimeout(nextSong, 2000);
        }
      }

      function updateStatus(text) {
        document.getElementById("status").textContent = text;
      }

      function levenshtein(a, b) {
        const m = [];
        for (let i = 0; i <= b.length; i++) m[i] = [i];
        for (let j = 0; j <= a.length; j++) m[0][j] = j;
        for (let i = 1; i <= b.length; i++) {
          for (let j = 1; j <= a.length; j++) {
            m[i][j] =
              b.charAt(i - 1) == a.charAt(j - 1)
                ? m[i - 1][j - 1]
                : Math.min(
                    m[i - 1][j - 1] + 1,
                    m[i][j - 1] + 1,
                    m[i - 1][j] + 1
                  );
          }
        }
        return m[b.length][a.length];
      }

      // Overlay with click-to-dismiss
      document
        .getElementById("overlay-feedback")
        .addEventListener("click", hideOverlay);

      function showOverlay(message, color = "white") {
        const overlay = document.getElementById("overlay-feedback");
        const feedback = document.getElementById("feedback");
        feedback.textContent = message;
        feedback.style.color = color;
        overlay.style.opacity = "1";
        overlay.style.pointerEvents = "auto";
        setTimeout(hideOverlay, 2000); // auto-hide
      }

      function hideOverlay() {
        const overlay = document.getElementById("overlay-feedback");
        overlay.style.opacity = "0";
        overlay.style.pointerEvents = "none";
      }

      setMode("hard"); // start in Hard mode
    </script>
  </body>
</html>
